<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Statistiques</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }

             header {
    width: 100%;
    padding: 20px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
border-bottom: 1px solid #ddd;
    position: relative;
}

.left  {
    flex: 1;
    display: flex;
    align-items: center;
 padding-left: 10px;
  
}
.center{
     flex: 1;
    display: flex;
    align-items: center;
 justify-content: left;
   
}
.right{
     flex: 1;
    display: flex;
    align-items: center;
 justify-content: right;
 padding-right: 10px;
    
}

.center h1 {
 
    margin: 0;
}

.nav-icon {
    width: 32px;
    height: 32px;
    cursor: pointer;
}

    
    .section {
      margin-top: 2rem;
    }
    .carte-france {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 1rem;
      background-color: white;
    }
    .encadre {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background-color: white;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .carte-img {
      width: 100%;
      height: auto;
    }
    #map {
      height: 500px;
      width: 100%;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background-color: white;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

    <header>
  <div class="left">
    <img id="home-btn" class="nav-icon" onclick="location.href='accueilEmploye.html'"  src="https://cdn-icons-png.flaticon.com/512/7606/7606153.png" alt="Accueil" title="Accueil">
  </div>

  <div class="center">
   <h1>Stats</h1>
  </div>

 
</header>


  <div class="container section">
    <div class="row">
      <div class="col-md-8">
        <div id="map"></div>
        <p class="text-center mt-2"><strong id="totalConsultations">Chargement des consultations...</strong></p>
     
      </div>

      <div class="col-md-4">
        <div class="encadre">
          <h5>Top 5 des médiums</h5>
          <ol>
            <li>Nom Médium 1</li>
            <li>Nom Médium 2</li>
            <li>Nom Médium 3</li>
            <li>Nom Médium 4</li>
            <li>Nom Médium 5</li>
          </ol>
        </div>

        <div class="encadre">
          <h5>Top 5 des employés</h5>
          <ol>
            <li>Nom Employé 1</li>
            <li>Nom Employé 2</li>
            <li>Nom Employé 3</li>
            <li>Nom Employé 4</li>
            <li>Nom Employé 5</li>
          </ol>
        </div>

        
      </div>
    </div>
  </div>
     <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
</body>

<script>
    document.addEventListener('DOMContentLoaded', () => {
      // Initialisation de la carte Leaflet centrée sur la France
      const map = L.map('map').setView([46.6, 2.4], 6);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      // Récupérer les clients depuis ton endpoint
      fetch('ActionServlet?todo=listerClients')
        .then(response => response.json())
        .then(data => {
            console.log(data);
          let totalConsultations = 0;

          data.clients.forEach(client => {
              console.log(client);
            if(client.latitude) {
              L.marker([client.latitude, client.longitude])
                .addTo(map)
                .bindPopup(`<strong>${client.nom}</strong><br/>Consultations : ${client.consultations || 0}`).openPopup();
            }
            totalConsultations += client.consultations || 0;
          });
      

         
        })
        .catch(err => {
          console.error('Erreur chargement clients :', err);
          
        });

      // Ici tu peux aussi charger et afficher les tops (mediums et employés) si besoin
    });
document.addEventListener('DOMContentLoaded', () => {
    fetch("ActionServlet?todo=statistiques")
        .then(response => response.json())
        .then(data => {
            const employes = data.employes;
            const mediums = data.mediums;

            const topMediumsList = document.querySelector('.encadre:nth-of-type(1) ol');
            const topEmployesList = document.querySelector('.encadre:nth-of-type(2) ol');
            const totalConsultationsDiv = document.getElementById('totalConsultations'); // assume tu as un div

            topMediumsList.innerHTML = '';
            topEmployesList.innerHTML = '';

            function remplirListe(listeDOM, items) {
                for(let i = 0; i < 5; i++) {
                    const li = document.createElement('li');
                    if(i < items.length) {
                        li.textContent = items[i].nom; // adapte la clé ici si besoin
                    } else {
                        li.textContent = ''; // ligne vide
                    }
                    listeDOM.appendChild(li);
                }
            }

            remplirListe(topMediumsList, mediums);
            remplirListe(topEmployesList, employes);
             let totalConsultations = 0;

         
            totalConsultations += employes.reduce((sum, e) => sum + (e.nbConsultations || 0), 0);
            totalConsultationsDiv.textContent = `Nombre total de consultations : ${totalConsultations}`;
          

        })
        .catch(error => console.error("Erreur chargement statistiques :", error));
});
</script>

</html>
